<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Math Genius — Grades 4–8</title>
<meta name="description" content="AI-powered math tutor for Grades 4–8 with step-by-step explanations." />
<style>
:root{--bg:#0b1020;--panel:#101935;--muted:#9db2ce;--text:#eaf2ff;--brand:#4cc9f0;--accent:#80ffea;--danger:#ff6b6b;--ok:#22c55e;--shadow:0 12px 30px rgba(0,0,0,.35);--radius:20px;}
*{box-sizing:border-box}html,body{height:100%}body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";background:radial-gradient(1200px 800px at 80% -10%, rgba(76,201,240,.15), transparent 60%),radial-gradient(1000px 600px at -10% 100%, rgba(128,255,234,.12), transparent 60%),var(--bg);color:var(--text);}
.wrap{display:grid;grid-template-rows:auto 1fr auto;min-height:100vh;}header{position:sticky;top:0;z-index:5;backdrop-filter: blur(8px);background: rgba(11,16,32,.6);border-bottom:1px solid rgba(255,255,255,.06);}
.bar{max-width:1100px;margin:0 auto;padding:14px 18px;display:flex;gap:12px;align-items:center;}
.logo{display:flex;align-items:center;gap:10px;}
.logo .dot{width:12px;height:12px;border-radius:50%;background:var(--brand);box-shadow:0 0 18px var(--brand)}
.title{font-weight:700;letter-spacing:.3px}.sub{color:var(--muted);font-size:12px}
.spacer{flex:1}.controls{display:flex;gap:10px;align-items:center}
.pill{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;background:#0e1630;border:1px solid rgba(255,255,255,.08)}
.select{appearance:none;background:transparent;border:none;color:var(--text);font-weight:600}
.hint{font-size:12px;color:var(--muted)}
main{max-width:1100px;margin:18px auto;padding:0 18px;display:grid;grid-template-columns:1fr 320px;gap:16px}
@media (max-width:980px){main{grid-template-columns:1fr}}
.card{background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));border:1px solid rgba(255,255,255,.08);border-radius: var(--radius);box-shadow: var(--shadow);}
.chat{display:flex;flex-direction:column;height:72vh;min-height:520px}
.feed{flex:1;overflow:auto;padding:18px 18px}
.msg{display:grid;grid-template-columns:38px 1fr;gap:12px;margin-bottom:14px}
.avatar{width:38px;height:38px;border-radius:50%;background:linear-gradient(135deg, var(--brand), #5583f1)}
.bubble{background:#0e1736;border:1px solid rgba(255,255,255,.06);padding:12px 14px;border-radius:14px;line-height:1.45}
.me .bubble{background:#0c2030;border-color: rgba(128,255,234,.25)}
.meta{font-size:12px;color:var(--muted);margin-bottom:6px}
.composer{display:flex;gap:10px;padding:12px;border-top:1px solid rgba(255,255,255,.08)}
textarea{flex:1;resize:none;max-height:160px;min-height:48px;background:#0b152f;color:var(--text);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px;outline:none}
button{background:var(--brand);color:#081022;border:none;padding:12px 16px;border-radius:12px;font-weight:700;cursor:pointer}
button:disabled{opacity:.6;cursor:not-allowed}
.ghost{background:transparent;color:var(--text);border:1px solid rgba(255,255,255,.12)}
.rail{display:flex;flex-direction:column;gap:16px}.rail .panel{padding:14px}
.panel h3{margin:0 0 8px;font-size:14px;letter-spacing:.2px;color:var(--accent)}
.list{display:flex;flex-direction:column;gap:8px}
.tip{font-size:13px;color:var(--muted)}
.bodmas{position: fixed; bottom: 20px; right: 20px; z-index:6;}
.bodmas .box{background:#0d1b2a;border:1px solid rgba(255,255,255,.08);border-radius:16px;box-shadow: var(--shadow);width:260px}
.bodmas header{position:relative;top:auto;backdrop-filter:none;background:transparent;border-bottom:1px solid rgba(255,255,255,.08);border-top-left-radius:16px;border-top-right-radius:16px}
.bodmas .hdr{display:flex;align-items:center;justify-content:space-between;padding:10px 12px}
.bodmas h4{margin:0;font-size:14px;color:var(--brand)}
.toggle{background:transparent;color:var(--text);border:none;padding:6px 10px;cursor:pointer}
.bodmas .content{padding:10px 12px;}table{width:100%;border-collapse:collapse;}td{padding:6px 6px;border-bottom:1px solid rgba(255,255,255,.08);font-size:13px}tr:last-child td{border-bottom:none}
.muted{color:var(--muted)}
.badge{display:inline-block;font-size:10px;padding:2px 8px;border:1px solid rgba(255,255,255,.12);border-radius:999px;margin-left:6px;color:var(--muted)}
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:100px;background:#0e1736;color:var(--text);border:1px solid rgba(255,255,255,.08);padding:10px 14px;border-radius:12px;display:none}
.show{display:block}
.symbols{display:flex;gap:6px;margin-bottom:6px;flex-wrap:wrap}
.symbols button{padding:4px 8px;border-radius:6px;font-size:14px;background:#101935;border:1px solid rgba(255,255,255,.08);color:var(--text);cursor:pointer}
</style>
</head>
<body>
<div class="wrap">
<header>
<div class="bar">
<div class="logo"><span class="dot"></span>
<div>
<div class="title">Math Genius <span class="badge">Grades 4–8</span></div>
<div class="sub">Accurate, step‑by‑step help • English / Afrikaans</div>
</div></div>
<div class="spacer"></div>
<div class="controls">
<div class="pill" title="Language">
<span>Language</span>
<select id="lang" class="select" aria-label="Language">
<option value="en" selected>English</option>
<option value="af">Afrikaans</option>
</select>
</div>
<button class="ghost" id="clearBtn" title="Clear chat">Clear</button>
</div>
</div>
</header>
<main>
<section class="card chat" aria-label="Chat">
<div id="feed" class="feed" role="log" aria-live="polite"></div>
<div class="symbols">
<button onclick="insertSymbol(' + ')">+</button>
<button onclick="insertSymbol(' - ')">-</button>
<button onclick="insertSymbol(' * ')">×</button>
<button onclick="insertSymbol(' / ')">÷</button>
<button onclick="insertSymbol('^')">^</button>
<button onclick="insertSymbol('√')">√</button>
<button onclick="insertFraction()">Fraction</button>
</div>
<div class="composer">
<textarea id="input" placeholder="Ask a maths question… e.g., 12 ÷ (3 × 2) + 5" spellcheck="true"></textarea>
<button id="send">Send</button>
</div>
</section>
<aside class="rail">
<div class="card panel">
<h3>Quick Starters</h3>
<div class="list">
<button class="ghost" onclick="prefill('Solve: 3 + 6 × (5 − 2) ÷ 3')">Order of operations</button>
<button class="ghost" onclick="prefill('Find the LCM of 6 and 8')">LCM</button>
<button class="ghost" onclick="prefill('What is 3/4 + 2/3? Show steps')">Fractions</button>
<button class="ghost" onclick="prefill('Convert 450 cm to meters')">Units</button>
</div>
<p class="tip">Tip: Use brackets for clarity, e.g., <span class="muted">12 ÷ (3 × 2)</span>.</p>
</div>
<div class="card panel">
<h3>Safety & Accuracy</h3>
<p class="tip">Always check your steps. The app shows the method so you can learn, not just the final answer.</p>
</div>
</aside>
</main>
</div>
<div class="bodmas" aria-live="polite">
<div class="box">
<div class="hdr">
<h4>BODMAS / PEMDAS</h4>
<button class="toggle" id="toggleBodmas" aria-expanded="true" aria-controls="bodmasContent">Hide</button>
</div>
<div id="bodmasContent" class="content">
<table>
<tr><td><strong>B / P</strong></td><td>Brackets / Parentheses</td></tr>
<tr><td><strong>O / E</strong></td><td>Orders / Exponents</td></tr>
<tr><td><strong>D</strong></td><td>Division</td></tr>
<tr><td><strong>M</strong></td><td>Multiplication</td></tr>
<tr><td><strong>A</strong></td><td>Addition</td></tr>
<tr><td><strong>S</strong></td><td>Subtraction</td></tr>
</table>
<p class="tip">Left-to-right for division & multiplication, and addition & subtraction.</p>
</div>
</div>
</div>
<div class="toast" id="toast" role="status" aria-live="polite"></div>
<script>
const el = q => document.querySelector(q);
const feed = el('#feed');
const input = el('#input');
const sendBtn = el('#send');
const clearBtn = el('#clearBtn');
const langSel = el('#lang');
const toast = el('#toast');

function toastMsg(msg){toast.textContent=msg;toast.classList.add('show');setTimeout(()=>toast.classList.remove('show'),1800);}
function prefill(text){input.value=text;input.focus();}
function insertSymbol(sym){input.value+=sym; input.focus();}
function insertFraction(){input.value+='[ ]/[ ]';input.focus();}

function addMessage({role, html}){const row=document.createElement('div');row.className='msg '+(role==='user'?'me':'ai');const avatar=document.createElement('div');avatar.className='avatar';const bubble=document.createElement('div');bubble.className='bubble';bubble.innerHTML=html;row.appendChild(avatar);row.appendChild(bubble);feed.appendChild(row);feed.scrollTop=feed.scrollHeight;}
function sanitize(text){const div=document.createElement('div');div.textContent=text;return div.innerHTML;}
function translate(text, to){if(to==='af'){return text.replaceAll('Step','Stap').replaceAll('Answer','Antwoord').replaceAll('Check','Toets').replaceAll('Multiply','Vermenigvuldig').replaceAll('Divide','Deel').replaceAll('Add','Tel by').replaceAll('Subtract','Trek af');}return text;}

// ===== OpenAI Integration =====
const USE_DEMO=false;
const openaiKey='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';

async function solveWithAI(prompt, lang){
    if(USE_DEMO){return 'Demo: '+prompt;}
    const resp = await fetch('https://api.openai.com/v1/chat/completions',{
        method:'POST',
        headers:{'Content-Type':'application/json','Authorization':`Bearer ${openaiKey}`},
        body: JSON.stringify({
            model:'gpt-3.5-turbo',
            messages:[
                {role:'system',content:'You are a step-by-step math tutor for Grades 4–8. Show all numeric steps clearly. Include fractions like 3/4, square roots √, and exponents ^.'},
                {role:'user', content: prompt}
            ],
            temperature:0.2
        })
    });
    const data = await resp.json();
    const text = data.choices[0].message.content;
    return sanitize(translate(text, lang));
}

// ===== Events =====
async function handleSend(){
    const q=input.value.trim();
    if(!q){return;}
    addMessage({role:'user', html:sanitize(q)});
    input.value='';
    sendBtn.disabled=true;
    try{
        const html=await solveWithAI(q, langSel.value);
        addMessage({role:'assistant', html:'<div class="meta">BODMAS/PEMDAS applied</div>'+html.replace(/\n/g,'<br>')});
    }catch(err){
        addMessage({role:'assistant', html:'<span style="color:var(--danger)">Sorry, something went wrong. Try again.</span>'});
    }finally{sendBtn.disabled=false; input.focus();}
}

sendBtn.addEventListener('click', handleSend);
input.addEventListener('keydown', e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();handleSend();}});
clearBtn.addEventListener('click', ()=>{feed.innerHTML='';toastMsg('Chat cleared');});

const toggleBtn = el('#toggleBodmas');
const bodmasContent = el('#bodmasContent');
toggleBtn.addEventListener('click', ()=>{const open=bodmasContent.style.display!=='none';bodmasContent.style.display=open?'none':'block';toggleBtn.textContent=open?'Show':'Hide';toggleBtn.setAttribute('aria-expanded',String(!open));});

// Welcome
addMessage({role:'assistant', html:'<div class="meta">Welcome</div>Ask me a Grade 4–8 maths question. Try: <code>12 ÷ (3 × 2) + 5</code>'});

// Language UI Switching
langSel.addEventListener('change', ()=>{
    const enText={title:'Math Genius', sub:'Accurate, step‑by‑step help • English / Afrikaans', clear:'Clear', quick:['Order of operations','LCM','Fractions','Units'], tip:'Tip: Use brackets for clarity, e.g., 12 ÷ (3 × 2)'};
    const afText={title:'Wiskunde Genius', sub:'Nauwkeurige, stapsgewyse hulp • Engels / Afrikaans', clear:'Maak skoon', quick:['Rekenvolgorde','KGV','Breuke','Eenhede'], tip:'Wenk: Gebruik hakies vir duidelikheid, bv. 12 ÷ (3 × 2)'};
    const t = langSel.value==='af'?afText:enText;
    document.querySelector('.title').childNodes[0].nodeValue=t.title+' ';
    document.querySelector('.sub').textContent=t.sub;
    clearBtn.textContent=t.clear;
    document.querySelectorAll('.rail .list button').forEach((b,i)=>{b.textContent=t.quick[i];});
});
</script>
</body>
</html>
